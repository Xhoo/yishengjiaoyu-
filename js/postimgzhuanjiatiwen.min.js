
$(function() {

	var localhost = "http://192.168.50.11/lifetime";
	var path = "/platform/upload";
	var url=localhost+path;
	var shuju = {
		file:"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"	
		};
//	shuju.type = 1;
//	shuju.integral = 0;
	var arr = [];
	//alert(121212121);
	console.log($("#img"))
	console.log($(".filepath1"))
		//$("#img").on("change",function(){alert(1)});
		////////////////////////////////////////////////////
	$("#img").on("change", ".filepath1", function() {
//		alert(22222)
		var oUrl = this.files[0];
		var srcs = window.URL.createObjectURL(oUrl);
		//		var srcs = window.URL.createObjectURL(oUrl);//有的浏览器上面不兼容
		var oUrl = this.files[0];
		console.log(oUrl)

		function readFile(obj) {
			//判断类型是不是图片  
			if(!/image\/\w+/.test(obj.type)) {
				function tishi2(value) {
					$(".erra").html(value)
					console.log($(".erra"))
					$(".erra").html(value)
					$(".erra").fadeIn(300, function() {
						setTimeout(function() {
							$(".erra").fadeOut()
						}, 500)
					})
				}
				tishi2("请选择图片")
				return false;
			}
			var reader = new FileReader();
			reader.readAsDataURL(obj);
			reader.onload = function(e) {
				arr.push(this.result)
					//              alert(arr); //就是base64  
				console.log(arr)
			}
		}

		function del() {
			$(this).parent().hide(); //this指的是span
			$(this).parent().nextAll(".img22").hide();
			$(this).parent().nextAll(".img11").show();
			if($('.imgbox1').length > 1) {
				$(this).parent().parent().remove()
			};
		}
		readFile(oUrl)
		var htmlImg = '<div class="imgbox1">' +
			'<div class="imgnum1">' +
			'<input type="file" class="filepath1" />' +
			'<span class="close1"><img src="img/del.png"/></span>' +
			'<img src="img/ic_uploading_photo.png" class="img11" />' +
			'<img src="' + srcs + '" class="img22" />' +
			'</div>' + '</div>';

		$(this).parent().parent().before(htmlImg);
		$(this).val(''); //必须制空
		$(this).parent().parent().prev().find(".img11").hide(); //this指的是input
		$(this).parent().parent().prev().find('.close1').show();
		$(".close1").on("click", del);

	});

	$("#text").on("focus", function() {
		$("#text").css({
			"borderColor": "#CCC"
		})
	});

	$(".jifen p:nth-of-type(2) input").on("touchstart", function() {
		$(".jifen p:nth-of-type(2) input").attr("class", "");
		$(".jifen input[type=text]").attr("disabled", "disabled");
		shuju.integral = $(this).attr("class", "inputActive").val();
		console.log(shuju.integral);
		if($(this).val() == "其他") {
			$(".jifen input[type=text]").removeAttr("disabled");
			console.log(shuju.integral)
		} else if($(this).val() == "无") {
			$(".jifen input[type='text']").val("");
			$(".jifen input[type=text]").attr("disabled", "disabled");
			$("#text").css({
				"borderColor": "#CCC"
			});
			shuju.integral = 0
		} else {
			$(".jifen input[type='text']").val("");
			shuju.integral = parseInt($(this).val());
			$("#text").css({
				"borderColor": "#CCC"
			})
		}
	});
	console.log(shuju.integral);

	function tishi(value) {
		$("#text").css({
			"borderColor": "#f93a3a"
		});
		console.log($(".erra"));
		$(".erra").html(value);
		$(".erra").fadeIn(300, function() {
			setTimeout(function() {
				$(".erra").fadeOut()
			}, 500)
		})
	}

	function ajax(shuju,url) {
		console.log(shuju,url);
		$.ajax({
			url: url,//http://192.168.50.11/lifetime/label/upload
//			/platform/upload
			dataType: "json",
			async: true,
			data: shuju,//JSON.stringify(shuju),
			type: "POST",
			contentType: "application/json",
			beforeSend: function() {
				console.log(arr);
				console.log("======== 请求之前调用 =========")
			},
			success: function(data) {
				console.log("========= 服务器响应成功调用 ==========");
				console.log(data)
			},
			error: function() {
				console.log("======= 服务器响应失败调用 ==========")
			},
			complete: function() {
				console.log("======== 请求完毕之后调用，注意：无论服务器响应成功与否，都会调用这个函数！！ ===========")
			}
		})
	};

	$(".header-right").on("touchstart", function() {
//		shuju.file = {"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"};
		console.log(shuju.problemImage);
		if($("#text").val()) {
			var reg = /^\+?[1-9][0-9]*$/;
			if(reg.test($("#text").val())) {
				shuju.integral = parseInt($("#text").val());
				ajax(shuju, localhost)
			} else {
				tishi("输入有误！")
			}
		} else {
			ajax(shuju,url)
		}
	});
	$(".button input:nth-of-type(1)").on("touchstart", function() {});
	$(".button input:nth-of-type(2)").on("touchstart", function() {});
});