var localhost = "http://192.168.50.70/lifetime";
var path = "/problem/add_problem";
var shuju = {};
shuju.type = 1;
shuju.integral = 0;
var arr = [];
//、、、、、、、、、、、、、、、、、、、、、、、、、
$("#img").on("change", ".filepath1", function() {
	var oUrl = this.files[0];
	var srcs = window.URL.createObjectURL(oUrl);
	//		var srcs = window.URL.createObjectURL(oUrl);//有的浏览器上面不兼容
	var oUrl = this.files[0];
	console.log(oUrl)

	function readFile(obj) {
		//判断类型是不是图片  
		if(!/image\/\w+/.test(obj.type)) {
			function tishi2(value) {
				$(".erra").html(value)
				console.log($(".erra"))
				$(".erra").html(value)
				$(".erra").fadeIn(300, function() {
					setTimeout(function() {
						$(".erra").fadeOut()
					}, 500)
				})
			}
			tishi2("请选择图片")
			return false;
		}
		var reader = new FileReader();
		reader.readAsDataURL(obj);
		reader.onload = function(e) {
			arr.push(this.result)
				//              alert(arr); //就是base64  
			console.log(arr)
		}
	}

	function del() {
		$(this).parent().hide(); //this指的是span
		$(this).parent().nextAll(".img22").hide();
		$(this).parent().nextAll(".img11").show();
		if($('.imgbox1').length > 1) {
			$(this).parent().parent().remove()
		};
	}
	readFile(oUrl)
	var htmlImg = '<div class="imgbox1">' +
		'<div class="imgnum1">' +
		'<input type="file" class="filepath1" />' +
		'<span class="close1"><img src="img/del.png"/></span>' +
		'<img src="img/ic_uploading_photo.png" class="img11" />' +
		'<img src="' + srcs + '" class="img22" />' +
		'</div>' + '</div>';

	$(this).parent().parent().before(htmlImg);
	$(this).val(''); //必须制空
	$(this).parent().parent().prev().find(".img11").hide(); //this指的是input
	$(this).parent().parent().prev().find('.close1').show();
	$(".close1").on("click", del);

});


$("#text").on("focus", function() {
	$("#text").css({
		"borderColor": "#CCC"
	})
});

$(".jifen p:nth-of-type(2) input").on("touchstart", function() {
	$(".jifen p:nth-of-type(2) input").attr("class", "");
	$(".jifen input[type=text]").attr("disabled", "disabled");
	shuju.integral = $(this).attr("class", "inputActive").val();
	console.log(shuju.integral);
	if($(this).val() == "其他") {
		$(".jifen input[type=text]").removeAttr("disabled");
		console.log(shuju.integral)
	} else if($(this).val() == "无") {
		$(".jifen input[type='text']").val("");
		$(".jifen input[type=text]").attr("disabled", "disabled");
		$("#text").css({
			"borderColor": "#CCC"
		});
		shuju.integral = 0
	} else {
		$(".jifen input[type='text']").val("");
		shuju.integral = parseInt($(this).val());
		$("#text").css({
			"borderColor": "#CCC"
		})
	}
});
console.log(shuju.integral);

function tishi(value) {
	$("#text").css({
		"borderColor": "#f93a3a"
	});
	console.log($(".erra"));
	$(".erra").html(value);
	$(".erra").fadeIn(300, function() {
		setTimeout(function() {
			$(".erra").fadeOut()
		}, 500)
	})
}

function ajax(shuju) {
	console.log(shuju);
	$.ajax({
		url: localhost()+"label/upload",
		dataType: "json",
		async: true,
		data: JSON.stringify(shuju),
		type: "POST",
		contentType: "application/json",
		beforeSend: function() {
			console.log(arr);
			console.log("======== 请求之前调用 =========")
		},
		success: function(data) {
			console.log("========= 服务器响应成功调用 ==========");
			console.log(data)
		},
		error: function() {
			console.log("======= 服务器响应失败调用 ==========")
		},
		complete: function() {
			console.log("======== 请求完毕之后调用，注意：无论服务器响应成功与否，都会调用这个函数！！ ===========")
		}
	})
};

$(".header-right").on("touchstart", function() {
	shuju.problemImage = arr;
	console.log(shuju.problemImage);
	if($("#text").val()) {
		var reg = /^\+?[1-9][0-9]*$/;
		if(reg.test($("#text").val())) {
			shuju.integral = parseInt($("#text").val());
			ajax(shuju, localhost)
		} else {
			tishi("输入有误！")
		}
	} else {
		ajax(shuju, localhost)
		addHttpUrl(shuju)
	}
});
$(".button input:nth-of-type(1)").on("touchstart", function() {
	var urls="yishengjiaoyu/html/qzindex.html";
	getPath(urls);

});
$(".button input:nth-of-type(2)").on("touchstart", function() {
	var urls="yishengjiaoyu/html/qzindex.html";
	getPath(urls);

});