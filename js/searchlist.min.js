$(function(){
	

function getUrl1(preUrl){
   	var result = {};
   	  url1=preUrl.split('?')[1];
   	  var map = url1.split('&');
   	  var len=map.length;
   	  for(var i=0;i<len;i++){
   	  	result[map[i].split('=')[0]] = map[i].split('=')[1];	        	  	
   	  };
   	  return result;
};
	//需要参数  localhost()
	var preUrl = window.location.href;
	var splitUrl = getUrl1(preUrl);
	console.log(splitUrl)
	var url1=localhost() + "problem/get_search_for_list?type=0&text=" + splitUrl.text;
	$.ajax({
		url: url1,
		dataType: "json",
		async: true,
		type: "GET",
		beforeSend: function() {
			console.log("======== 请求之前调用 =========")
		},
		success: function(shuju) {
		if(shuju.code==1002){window.location.href=locationHref()+'yishengjiaoyu/login';}
			
			console.log("========= 服务器响应成功调用 ==========");
			for(var value of shuju.data.problemModelList) {
				function jsDateDiff(publishTime) {
					var d_minutes, d_hours, d_days;
					var timeNow = Date.parse(new Date()) / 1000;
					console.log(timeNow);
					var d;
					var s = new Date(publishTime * 1000);
					d = timeNow - publishTime;
					d_days = parseInt(d / 86400);
					d_hours = parseInt(d / 3600);
					d_minutes = parseInt(d / 60);
					if(d_days > 0 && d_days < 4) {
						return d_days + "天前"
					} else if(d_days <= 0 && d_hours > 0) {
						return d_hours + "小时前"
					} else if(d_hours <= 0 && d_minutes > 0) {
						return d_minutes + "分钟前"
					} else if(d_minutes <= 0) {
						return "刚刚"
					} else {
						return s.getFullYear() + "年" + (s.getMonth() + 1) + "月" + s.getDate() + "日";
					}
				}
				console.log(jsDateDiff(value.time));
				$("<li><div class='question'><div class='question-first'><p>" + value.problemTitle + "</p><span>" + value.problemContent + "</span></div><div class='question_img'><img src=" + value.userModel.userUrl + "><img src=" + value.userModel.userUrl + "><img src=" + value.userModel.userUrl + "></div><div class='question-second'><div class=''><span class='school'>" + value.problemLevel + "</span><span class='nianji'></span><span class='kemu'></span></div><span class='time'>" + jsDateDiff(value.time) + "</span></div><div class='question-third'><img src=" + value.userModel.userUrl + "><div class='question-xinxi'><section class='section1'><span class='name'>" + value.userModel.userName + "</span><span class='jifen'>" + value.likeTotal + "回答</span></section><section class='section2'><span class='huida'>我来回答</span></section></div></div></div></li>").appendTo(".content-wenda")
			}
			for(var ans of shuju.data.problemAnswerList) {
				console.log(ans.problemImage[0]);
				$("<li><section class='section1'>" + ans.problemTitle + "</section><section class='section2'></section><section class='section3'><span class=''><img src=" + ans.userUrl + "></span><span class='voice1'><audio id='myAudio 'preload='auto'><source src='yinpin/夏小虎 - 这场名叫人生的旅途.mp3'  type='audio/mp3'></audio></span><span class=''>" + ans.acceptionAudios + "</span></section><section class='section4'><span class=''>" + ans.userName + "</span><span class=''>" + ans.specialistJobtitle + "</span><span class=''></span><span class='dianzan'><img src='img/ic_up_blue.png'/>" + ans.orderStatus + "</span><span class=''>" + ans.likeTotal + "人听过</span></section></li>").appendTo(".content");
				if(ans.like == 1) {
					$(".section4 .dianzan img").attr('src', "img/ic_up_blue.png")
				} else {
					$(".section4 .dianzan img").attr('src', "img/zan.gif")
				}
				for(var oImg of ans.problemImage) {
					console.log(oImg);
					$("<img src=" + oImg + ">").appendTo(".content .section2")
				}
			}
		},
		error: function() {
			console.log("======= 服务器响应失败调用 ==========")
		},
		complete: function() {
			console.log("======== 请求完毕之后调用，注意：无论服务器响应成功与否，都会调用这个函数！！ ===========")
		}
	});
	$(".tab li:nth-of-type(1)").on("touchstart", function() {
		$(".tab li").attr("class", "");
		$(this).attr("class", "tabActive");
		$(".content").css("display", "none");
		$(".content-wenda").css("display", "block")
	});
	$(".tab li:nth-of-type(2)").on("touchstart", function() {
		$(".tab li").attr("class", "");
		$(this).attr("class", "tabActive");
		$(".content-wenda").css("display", "none");
		$(".content").css("display", "block")
	});
//	console.log($(".header-left img"))
	$(".header-left img").on("touchstart", function() {
//		var 
//		getPath("yishengjiaoyu/html/qzindex.html");
		 window.history.back(-1); 
	});
	$(".header-right").on("touchstart",function(){
		getPath("yishengjiaoyu/search.html");
	})
});